#!/bin/bash
#
# Defines the benchmark suite by overriding setParams.
#
# Overrides setupBenchmark to generate a payload file for StaticFile
# Overrides postBenchmark to clean up excess logs generated by HelloLogging
#

#
# Override ITERATIONS, DURATION and CLIENTS to perform a quick verification
# (functional correctness) using the standard benchmark execution mechanism.
#
function verifyTest {
    local BENCHMARK_NAME="$1"

    BENCHMARK_MODE="verify"
    executeTest "$BENCHMARK_NAME"
}

function setParams {
    local TESTNAME="$1"
    case "$TESTNAME" in
    TFB-DB-Kuery)
      IMPLEMENTATION="TechEmpowerPostgres"
      URL="http://localhost:8080/db"
      DURATION=60
      ITERATIONS=3
      CLIENTS=128
      # TODO: pre-run script needed?
      # At the moment this depends on the database server being left in a clean state between executions.
      #PRE_RUN_SCRIPT="$dir/scripts/postgres_setup.sh"
      ;;
    TFB-DB-Kuery-ORM)
      IMPLEMENTATION="TechEmpowerPostgresORM"
      URL="http://localhost:8080/db"
      DURATION=60
      ITERATIONS=3
      CLIENTS=128
      ;;
    TFB-DB-Kuery-ORM-Codable)
      IMPLEMENTATION="TechEmpowerPostgresORMCodable"
      URL="http://localhost:8080/db"
      DURATION=60
      ITERATIONS=3
      CLIENTS=128
      ;;
    TFB-DB-Mongo)
      IMPLEMENTATION="TechEmpowerMongoKitten"
      URL="http://localhost:8080/db"
      DURATION=60
      ITERATIONS=3
      CLIENTS=128
      ;;
    TFB-Updates-Kuery)
      IMPLEMENTATION="TechEmpowerPostgres"
      URL="http://localhost:8080/updates?queries=1"
      DURATION=60
      ITERATIONS=3
      CLIENTS=128
      ;;
    TFB-Updates-Kuery-ORM)
      IMPLEMENTATION="TechEmpowerPostgresORM"
      URL="http://localhost:8080/updates?queries=1"
      DURATION=60
      ITERATIONS=3
      CLIENTS=128
      ;;
    TFB-Updates-Kuery-ORM-Codable)
      IMPLEMENTATION="TechEmpowerPostgresORMCodable"
      URL="http://localhost:8080/updates?queries=1"
      DURATION=60
      ITERATIONS=3
      CLIENTS=128
      ;;
    TFB-Updates-Mongo)
      IMPLEMENTATION="TechEmpowerMongoKitten"
      URL="http://localhost:8080/updates?queries=1"
      DURATION=60
      ITERATIONS=3
      CLIENTS=128
      ;;
    TFB-Fortunes-Kuery)
      IMPLEMENTATION="TechEmpowerPostgres"
      URL="http://localhost:8080/fortunes"
      DURATION=60
      ITERATIONS=3
      CLIENTS=128
      ;;
    TFB-Fortunes-Kuery-ORM)
      IMPLEMENTATION="TechEmpowerPostgresORM"
      URL="http://localhost:8080/fortunes"
      DURATION=60
      ITERATIONS=3
      CLIENTS=128
      ;;
    TFB-Fortunes-Mongo)
      IMPLEMENTATION="TechEmpowerMongoKitten"
      URL="http://localhost:8080/fortunes"
      DURATION=60
      ITERATIONS=3
      CLIENTS=128
      ;;
    *)
      echo "Unknown test '$TESTNAME'"
      ;;
    esac
}

function setupBenchmark {
    local TESTNAME="$1"
    case "$TESTNAME" in
    *)
      # TODO: set up database?
      # At the moment this relies on the database being started in advance.
      ;;
    esac
}

function postBenchmark {
    local TESTNAME="$1"
    case "$TESTNAME" in
    *)
      # TODO: stop database?
      # At the moment the database will be left running after the run completes.
      ;;
    esac
}
